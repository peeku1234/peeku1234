   FUNCTION generatereferenceno (p_transactionname IN VARCHAR2)
      RETURN VARCHAR2
   AS
      strsequencename   VARCHAR2 (20);
      strrefcode        VARCHAR2 (2);
      strrefno          VARCHAR (10);
      strnextvalue      VARCHAR2 (10);
      ref_cur           txn_cur;
   BEGIN
      /*IF p_transactionName = 'FT' OR p_transactionName = 'LPP' THEN
          strRefCode := 'CI';
      ELSIF p_transactionName = 'TP' THEN
          strRefCode := 'CT';
      ELSIF p_transactionName = 'DD' THEN
          strRefCode := 'CD';
      ELSIF p_transactionName = 'BP' THEN
          strRefCode := 'CB';
      ELSIF p_transactionName = 'MP' THEN
          strRefCode := 'CK';
      ELSIF p_transactionName = 'PS' THEN
          strRefCode := 'CS';
      END IF;
      --strSequenceName := 'R' || strRefCode || 'REF.nextval';*/
      --strsequencename := 'R' || TRIM (p_transactionname) || 'REF.nextval';
      --Start of code added for Corporate fee transactions
      IF p_transactionName = 'FEE' THEN
        strRefCode := 'CU';
/* if condition 'SARALMTOPUP' is added on 12-Mar-15 for CR No:CINB0125 by veeraraju */
      ELSIF p_transactionName = 'SARALMTOPUP' THEN
        strRefCode := 'CV';        
      ELSE
        strRefCode := trim(p_transactionName);
      END IF;
      
      strSequenceName := 'R' || strRefCode || 'REF.nextval';
      
      --End of code added for Corporate fee transactions

      OPEN ref_cur
      FOR 'select '|| strSequenceName ||' from dual';
      LOOP
         FETCH ref_cur
          INTO strnextvalue;
         EXIT WHEN ref_cur%NOTFOUND;
         IF strRefCode IN ('CK','IU','CR')  THEN 
            strRefNo := strRefCode || CHR(SUBSTR(strNextValue,1,2)) || SUBSTR(strNextValue,3);
         ELSIF strRefCode in ('CX','CN','CI','CT')  THEN 
            strRefNo := strRefCode || LPAD(FN_ALPHA_NUM_REF_NO(FLOOR(strNextValue/10)),7,'0') || SUBSTR(strNextValue,-1);
         ELSE
            strRefNo := strRefCode || LPAD(strNextValue,8,'0');
         END IF;         
         --strrefno := TRIM (p_transactionname) || strnextvalue;
      END LOOP;
      RETURN strrefno;
   END generatereferenceno;
   
FUNCTION FN_ALPHA_NUM_REF_NO(P_SEQ_NO NUMBER) RETURN VARCHAR2
IS
L_MOD_VALUE NUMBER:=MOD(P_SEQ_NO,26);
L_DIV_VALUE NUMBER:= P_SEQ_NO/26;
L_RET_VALUE VARCHAR2(8);
BEGIN
    DBMS_OUTPUT.PUT_LINE('Mod: ' || L_MOD_VALUE || ' - ' || 'Div:' || L_DIV_VALUE);
--   L_MOD_VALUE := L_MOD_VALUE + 1;
    IF L_MOD_VALUE = 0 THEN L_MOD_VALUE := 26; L_DIV_VALUE:= L_DIV_VALUE-1; END IF;  

    IF L_DIV_VALUE >= 1 THEN
        L_RET_VALUE := fn_alpha_Num_ref_no(FLOOR(L_DIV_VALUE)) || CHR(64 + L_MOD_VALUE);
    ELSE
        L_RET_VALUE := CHR(64 + L_MOD_VALUE);
    END IF;
    RETURN L_RET_VALUE;
EXCEPTION
WHEN OTHERS THEN
    RETURN '*';
END;
 
END; 
